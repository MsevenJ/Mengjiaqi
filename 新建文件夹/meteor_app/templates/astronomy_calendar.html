<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>天象日历</title>
    <!-- 引入 flatpickr 的 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <!-- 加载自定义过滤器和 humanize 模板标签库 -->
    {% load custom_tags humanize %}
    <!-- 年份选择器 -->
    <input type="number" id="year-selector" min="2015" max="2030" placeholder="选择年份">
    <button id="load-year">加载该年份数据</button>
    <h1>天象日历</h1>
    <div id="calendar-container">
        <!-- 日历内容将动态显示在这里 -->
    </div>

    <!-- 引入 flatpickr 的 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.getElementById('load-year').addEventListener('click', function () {
            const year = document.getElementById('year-selector').value;
            if (year) {
                fetch(`/get-astronomy-events-by-year/?year=${year}`)
                   .then(response => response.json())
                   .then(data => {
                        const calendarContainer = document.getElementById('calendar-container');
                        let calendarHtml = '<table>';
                        calendarHtml += '<thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead>';
                        calendarHtml += '<tbody>';

                        // 这里需要根据返回的数据生成日历表格，示例中简单展示数据
                        data.events.forEach(event => {
                            calendarHtml += `<tr><td colspan="7">${event.summary} - ${event.dtstart} 到 ${event.dtend}</td></tr>`;
                        });

                        calendarHtml += '</tbody></table>';
                        calendarContainer.innerHTML = calendarHtml;
                    })
                   .catch(error => {
                        const calendarContainer = document.getElementById('calendar-container');
                        calendarContainer.innerHTML = `<p>错误: ${error.message}</p>`;
                    });
            }
        });
    </script>
</body>

</html>